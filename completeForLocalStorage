// function to check if local storage is available
function hasStorage() { 
    var test = 'test';
    try {
      localStorage.setItem(test, test);
      localStorage.removeItem(test);
      return true;
    } catch(e) {
      return false;
    }
}
var parent = document.getElementsByClassName('msg')[0];

// bring back ad after 12 hours since firstClick
function returnAd() {
    // get current time
    var x = new Date();
    var rn = x.getTime();
    // if current time has surpassed 12hrs since first adclick
    if (rn > parseInt(localStorage.getItem('date')) + 43200000) {
        // clear local Storage
        localStorage.removeItem('meter');
        localStorage.removeItem('date');
        // show ad
        parent.style.display = "block";
    }
}

if (hasStorage) { 
    document.addEventListener('DOMContentLoaded', function() {  

        if (parseInt(localStorage.getItem('meter')) < 3)  {
            var now = new Date();
            nowTime = now.getTime();
            if (nowTime > parseInt(localStorage.getItem('date')) + 43200000) {
                localStorage.removeItem('meter');
            }
            
        }
        else if (parseInt(localStorage.getItem('meter')) > 2) {
            parent.style.display = "none";
            setInterval(returnAd, 2000)
        }
        

        var ele, today, mil;
        var watch = setInterval(test, 500)

        function test() {
            ele = document.activeElement;
            localStorage.setItem('active', ele);
        }
    
        setInterval(function() {
            if (localStorage.getItem('active')) { 
                localStorage.setItem('counter', 0);
            }
            if (localStorage.getItem('active') ===  "[object HTMLIFrameElement]") {
                check();
            } 
        }, 500)


        function check() {
            if (!localStorage.getItem('meter')) {  
                // upon first click      
                localStorage.setItem('meter',  parseInt(localStorage.getItem('counter')) + 1); 
                // get current date object
                today = new Date();
                //get current time in millisecs
                mil = today.getTime();
                localStorage.setItem('date', mil);  
                setTimeout(function() {
                    document.getElementById('modlgn-username').focus();
                }, 200);   
                
            }
            else {
                localStorage.setItem('meter', parseInt(localStorage.getItem('meter')) + 1);

                if (parseInt(localStorage.getItem('meter')) > 2) {
                    thirdClick();
                }
                setTimeout(function() {
                    document.getElementById('modlgn-username').focus();
                }, 200);
            }
        }
        // upon third click
        function thirdClick() {
            // get current date object
            var rightNow = new Date();
            // get current time in millisecs
            var secondTime = rightNow.getTime();
            // check if it's been less than 12 hours since first click
            if (secondTime < parseInt(localStorage.getItem('date')) + 43200000) {
                // hide ad
                parent.style.display = "none";
            }
            else {
                localStorage.removeItem('meter');
            }
        }
    })
}
else {
    parent.style.display = "none";
}
